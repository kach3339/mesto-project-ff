(()=>{"use strict";var e=function(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))};function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранение...",n=e.querySelector(".popup__button"),o=n.textContent;return n.textContent=t,n.disabled="true",{completeModalSubmitting:function(){n.textContent=o,n.disabled="false"}}}var r=document.querySelector("#card-template").content.querySelector(".places__item");function u(e){var t=e.cardData,n=e.showRemoveButton,o=e.eventListeners,u=r.cloneNode(!0),i=u.querySelector(".card__title"),c=u.querySelector(".card__image"),a=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),d=u.querySelector(".card__like-quantity");return u.id=t._id,i.textContent=t.name,c.src=t.link,c.alt=t.name,d.textContent=t.likes.length,n||a.remove(),c.addEventListener("click",(function(){o.openFullImage({name:t.name,link:t.link})})),a.addEventListener("click",(function(){o.deleteClick(t._id)})),l.addEventListener("click",(function(){!function(e){var t=e.cardId,n=e.likeButton,o=e.likeClick,r="card__like-button_is-active";n.classList.toggle(r),o(t,n.classList.contains(r))}({cardId:t._id,likeButton:l,likeClick:o.likeClick})})),u}var i=function(e){document.getElementById(e._id).querySelector(".card__like-quantity").textContent=e.likes.length},c=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){a({formElement:e,inputElement:n,config:t})}))},a=function(e){var t=e.formElement,n=e.inputElement,o=e.config,r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(o.inputErrorClass),r.classList.remove(o.activeErrorClass),r.textContent=""},l=function(e){var t=e.inputList,n=e.buttonElement,o=e.inactiveButtonClass;!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(o),n.removeAttribute("disabled")):(n.disabled=!0,n.classList.add(o))},d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"a5b41191-4295-4942-b6d9-1f6a428d0b55","Content-Type":"application/json"}},s=function(e){var t=e.route,n=e.method,o=e.body;return fetch("".concat(d.baseUrl,"/").concat(t),{method:n,headers:d.headers,body:o?JSON.stringify(o):void 0}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))};function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var m=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),v=document.querySelectorAll(".popup"),_=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_card-delete"),b=document.querySelector(".popup_type_avatar"),h=document.forms["edit-profile"],g=document.forms["new-place"],k=document.forms["delete-card"],q=document.forms["change-avatar"],C=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),B=document.querySelector(".popup__input_type_avatar-url"),x=document.querySelector(".popup__input_type_name"),w=document.querySelector(".popup__input_type_description"),I=document.querySelector(".popup__input_type_card-name"),M=document.querySelector(".popup__input_type_url"),T=document.querySelector(".places__list"),D=document.querySelector(".popup__image"),j=document.querySelector(".popup__caption"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",activeErrorClass:"form__input-error_active"},O=function(e,t){var n=t?function(e){return s({route:"cards/likes/".concat(e),method:"PUT"})}(e):function(e){return s({route:"cards/likes/".concat(e),method:"DELETE"})}(e);n.then(i)},U=function(e){D.src=e.link,D.alt=e.name,j.textContent=e.name,t(S)},F=function(e){E.querySelector(".popup__button").dataset.cardId=e,t(E)},R=function(e){T.prepend(e)},G=function(e){C.textContent=e.name,L.textContent=e.about,A.style.backgroundImage="url('".concat(e.avatar,"')")};A.addEventListener("click",(function(){t(b),q.reset(),c(q,P)})),m.addEventListener("click",(function(){x.value=C.textContent,w.value=L.textContent,t(_),c(h,P)})),f.addEventListener("click",(function(){t(y),g.reset(),c(g,P)})),v.forEach((function(e){var t=e.querySelector(".popup__close");e.classList.add("popup_is-animated"),t.addEventListener("click",(function(){n(e)})),e.addEventListener("mousedown",(function(t){t.target===t.currentTarget&&n(e)}))})),q.addEventListener("submit",(function(e){e.preventDefault();var t,r=o(b).completeModalSubmitting;(t=B.value,s({route:"users/me/avatar",method:"PATCH",body:{avatar:t}})).then((function(e){G(e),r(),n(b)}))})),h.addEventListener("submit",(function(e){e.preventDefault();var t,r,u=o(_).completeModalSubmitting;(t=x.value,r=w.value,s({route:"users/me",method:"PATCH",body:{name:t,about:r}})).then((function(e){G(e),u(),n(_)}))})),g.addEventListener("submit",(function(e){e.preventDefault();var t,r,i=o(y).completeModalSubmitting;(t=I.value,r=M.value,s({route:"cards",method:"POST",body:{name:t,link:r}})).then((function(e){var t=u({cardData:e,showRemoveButton:!0,eventListeners:{openFullImage:U,deleteClick:F,likeClick:O}});R(t),I.value="",M.value="",i(),n(y)}))})),k.addEventListener("click",(function(e){e.preventDefault();var t=E.querySelector(".popup__button").dataset.cardId,r=document.getElementById(t),u=o(E,"Удаление...").completeModalSubmitting;(function(e){return s({route:"cards/".concat(e),method:"DELETE"})})(t).then((function(){r.remove(),u(),n(E)}))})),Promise.all([s({route:"users/me",method:"GET"}),s({route:"cards",method:"GET"})]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,u,i,c=[],a=!0,l=!1;try{if(u=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=u.call(n)).done)&&(c.push(o.value),c.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{if(!a&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],i=o[1];G(r),function(e,t){e.forEach((function(e){var n;n=u({cardData:e,showRemoveButton:t._id===e.owner._id,eventListeners:{openFullImage:U,deleteClick:F,likeClick:O}}),T.append(n)}))}(i,r)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l({inputList:n,buttonElement:o,inactiveButtonClass:t.inactiveButtonClass}),n.forEach((function(r){r.addEventListener("input",(function(){!function(e){var t=e.formElement,n=e.inputElement,o=e.config;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?a({formElement:t,inputElement:n,config:o}):function(e){var t=e.inputElement,n=e.errorMessage,o=e.config,r=e.formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.activeErrorClass)}({formElement:t,inputElement:n,errorMessage:n.validationMessage,config:o})}({formElement:e,inputElement:r,config:t}),l({inputList:n,buttonElement:o,inactiveButtonClass:t.inactiveButtonClass})}))}))}(t,e)}))}(P)})();